//let Code = Load("Directory","Code"), EVA = Expression.Evaluate(Code ,#shared) in EVA
let
    MonitorName = "Directory",
    Fn = fx("DBMonitor")(MonitorName),
    MergedQ = fx("Merge")(Fn, CWB("Table_PRJMerge"), "COMPARER", "COMPARER", {"承销费原币"}, {""}),
    NthMandate = fx("NthMandated")(MergedQ, {"YYMMDD", "信用主体"}),
    #"Count Multi-Tranche" = fx("AddMultiCount")(NthMandate),
    #"Merged Queries1" = Table.NestedJoin(
        #"Count Multi-Tranche", {"定价会时间"}, Load("DimTime"), {"Time"}, "Data", JoinKind.LeftOuter
    ),
    #"Expanded DimTime" = Table.ExpandTableColumn(#"Merged Queries1", "Data", {"DayPeriod"}, {"定价会时段"}),
    ExeTime =
        if Table.HasColumns(#"Expanded DimTime", "Date_Onboarded") then
            Table.AddColumn(
                #"Expanded DimTime",
                "执行周期",
                each
                    if not List.Contains({[定价日], [Date_Onboarded]}, null) and [定价日] >= [Date_Onboarded] then
                        Duration.Days([定价日] - [Date_Onboarded])
                    else
                        null,
                type number
            )
        else
            #"Expanded DimTime",
  
    ReplacedCCY = Table.ReplaceValue(ExeTime, "美元债", "", Replacer.ReplaceValue, {"货币细分"}),
      Sorted = fx("SortNIndex")(  ReplacedCCY),
    //Reorder
    CN_Base = List.Buffer(CWB("BaseDirectory_CN")),
    CN_CWB = List.Buffer(Table.ColumnNames(CWB("Directory"))),
    Reordered = Table.ReorderColumns( Sorted , CN_Base & List.RemoveItems(CN_CWB, CN_Base), MissingField.Ignore)
in
    Reordered
