// let LoadCode = Load("mIndice","Code"), EVA = Expression.Evaluate(LoadCode ,#shared) in EVA
let
    DB_Name = "mIndice",
    //【Input】Eligibility to include in this database
    Add_CN_DistinctCol = {"Check", "信用主体", "Date"},
    //
    Add_From = "Below",
    //【Input】Insert New From Top or Below
    RDupe_Method = "LIFO",
    //【Input】LIFO or FIFO
    Add_Source = wIndicePQ,
    //【Input】PQ//
    DB_Source = CWB(DB_Name),
    DB_Source_CN = Table.ColumnNames(DB_Source),
    DB_Source_CNCount = List.Count(DB_Source_CN),
    Add_HD = List.Intersect({Add_CN_DistinctCol, DB_Source_CN}){0},
    //
    #"Add_From_Result////" = if Add_From = "Top" then {Add_Source, DB_Source} else {DB_Source, Add_Source},
    Combined = Load("fxCombine")(#"Add_From_Result////", {"Keep"}, DB_Source_CN),
    #">>ShowDupe" = Table.Distinct(
        Table.Buffer(
            Table.Sort(
                Load("fxShowDupe")(Combined, {Add_HD}), {{Add_HD, Order.Descending}, {"Timestamp", Order.Descending}}
            )
        ),
        {Add_HD}
    ),
    RDupe_Indexed = Table.AddIndexColumn(Combined, Prefix & "RDupeIndex", 1, 1),
    #"RDupe_Order////" = if RDupe_Method <> "FIFO" then Order.Ascending else Order.Descending,
    RDupe_Sorted = Table.Buffer(
        Table.Sort(RDupe_Indexed, {{Add_HD, #"RDupe_Order////"}, {Prefix & "RDupeIndex", #"RDupe_Order////"}})
    ),
    RDupe_Removed = Table.Distinct(RDupe_Sorted, Add_HD),
     wRemove = Load("Controller")[RemoveFrom_DB]{0},
    wRemove_List = List.Buffer(Table.Column(Add_Source, Add_HD)),
    CrossRoad =
        if wRemove = "Y" then
            Table.SelectRows(DB_Source, each not List.Contains(wRemove_List, Record.Field(_, Add_HD)))
        else 
            fx("DBManager")(RDupe_Removed, "m"),

    RCol = Table.RemoveColumns(
            CrossRoad ,
        List.Select(DB_Source_CN, each Text.StartsWith(_, "Column") or Text.Contains(_, "DAX")),
        MissingField.Ignore
    ),
    _CGBUSTSPD_Tenor = {"R_CGB_3Y", "R_UST_3Y", "S_DAX_CGBUSTSPD"},
    ACol = Table.AddColumn(
        RCol,
        _CGBUSTSPD_Tenor{2},
        each (Record.Field(_, _CGBUSTSPD_Tenor{0}) - Record.Field(_, _CGBUSTSPD_Tenor{1})) * 10000,
        type number
    ),
    AvgNum =  List.Average(
                List.Buffer(Table.Column(Table.SelectRows(ACol, each [Date] > Date.FromText("2022/03/25")), _CGBUSTSPD_Tenor{2})
            )),
    ACol2 = Table.AddColumn(
        ACol,
        _CGBUSTSPD_Tenor{2} & "_AVG",
        each AvgNum ,
           
        type number
    ),
    Reordered = Table.ReorderColumns(ACol2,DB_Source_CN, MissingField.Ignore)
in
    Reordered