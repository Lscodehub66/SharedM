//Add ESG & FeaturedMore - You need 票息 to indicate FRN pls arrange after getting 票息
(TableName as table) =>
    let
        Source = TableName,
        // Featured
        FeaturedMore = Table.AddColumn(
            Source,
            "FEATURED",
            each
                if Text.Start([ISIN], 2) = "MO" then
                    "MOX"
                else if Text.Contains([计息基准], "+") or Text.Contains([票息], "+") then
                    "FRN"
                else if Text.StartsWith([ISIN], "CND") then
                    "Yulan"
                else if [主题债券] = "T2" then
                    "T2"
                else if [主题债券] = "AT1" and Text.Contains([特殊条款说明], "优先股") and List.Count(Text.Split([特殊条款说明], "优先股")) >= 4 then
                    "AT1(PrefShare)"
                else if [主题债券] = "AT1" then
                    "AT1"
                else if Text.Contains([特殊条款说明], "优先股") and List.Count(Text.Split([特殊条款说明], "优先股")) >= 4 then
                    "PrefShare"
                else if
                    Text.Contains([#"发行期限(年)"], "P")
                    and [主题债券] <> "AT1"
                    and [主题债券] <> "T2"
                    and Text.Contains([偿还顺位], "Subordinated")
                    or Text.Contains([偿还顺位], "Junior")
                then
                    "JuniorPerp"
                else if
                    Text.Contains([#"发行期限(年)"], "P")
                    and [主题债券] <> "AT1"
                    and [主题债券] <> "T2"
                    and not Text.Contains([偿还顺位], "Subordinated")
                    and not Text.Contains([偿还顺位], "Junior")
                then
                    "SnPerp"
                else
                    "--"
        ),
        HD = List.Intersect({{"ESG_Indicator", "主题债券"}, Table.ColumnNames(Source)}),
        // "筹款用途"
        MergedCol = Table.CombineColumns(
            FeaturedMore, HD, Combiner.CombineTextByDelimiter("", QuoteStyle.None), "ESG_Source"
        ),
        ESG_DMIBBG = Table.AddColumn(
            MergedCol,
            "ESG",
            each
                if Text.Contains([ESG_Source], "挂钩") then
                    "SLB"
                else if Text.Contains([ESG_Source], "可持续") or Text.Contains([ESG_Source], Sustain) then
                    "Sustainable"
                else if Text.Contains([ESG_Source], "社会") or Text.Contains([ESG_Source], Social) then
                    "Social"
                else if Text.Contains([ESG_Source], "绿") or Text.Contains([ESG_Source], Green) then
                    "Green"
                else
                    ""
        ),
        ESG_FrUOP =
            if List.Contains(Table.ColumnNames(Source), "筹款用途") then
                Table.ReplaceValue(
                    ESG_DMIBBG,
                    "",
                    each
                        if Text.Contains([筹款用途], "绿") then
                            "【Green】"
                        else if Text.Contains([筹款用途], "可持续") then
                            "【Sustainable】"
                        else
                            "",
                    Replacer.ReplaceValue,
                    {"ESG"}
                )
            else
                ESG_DMIBBG
    in
        ESG_FrUOP
