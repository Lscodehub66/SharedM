//let FileName = "CWB",Path  = if (try Excel.CurrentWorkbook(){[ Name = "GPS" ]}[Content][Column1]{0} otherwise "Global" ) = "Remote" then "C:\Users\ktkt2\OneDrive\EXE Team\DataHub\SharedM\" else "\\itd-m09-fs02\dcm$\Team Folder\Execution Team\DataHub\SharedM\",  EVA = Expression.Evaluate ( Text.FromBinary ( Binary.Buffer ( File.Contents ( Path&FileName ) ) ) ,#shared )in    EVA//
(_inputname as text, optional _inputkey as nullable text, optional _inputHD as list) =>
    let
        ThisExcel = Excel.CurrentWorkbook(){[Name = Text.Remove(_inputname, "@")]}[Content],
        DM = fx("Ws")("DEALSMASTER", "=" & _inputname),
        _key = if _inputkey = null then "" else _inputkey,
        _tblname = Text.Replace(Text.Upper(Text.Trim(_inputname)), "_", ""),
        NamedList = {
            "MONDAY",
            "UPDATORWEEKLY",
            "SHOWALL",
            "REMOVEFROMDB",
            "澳门FILTER",
            "香港FILTER",
            "WEEKLYFILTER",
            "ISEXCHFILTER",
            "MULTISOURCE",
            "GPS",
            "WEEKLYADDTAP","SYNCMEXE"
        },
        Source =
            if List.Contains(
                {"deal_master", "chart_master", "mIndice", "DLD_DMI_Missing_ISIN"},
                _inputkey,
                Comparer.OrdinalIgnoreCase
            ) then
                try ThisExcel otherwise try Load(_inputkey) otherwise DM
            else if List.Contains(NamedList, _tblname) then
                try ThisExcel otherwise Load(_inputkey)
            else if _key = "CWB" then
                ThisExcel
            else
                try ThisExcel otherwise DM,
        DataType = if _inputkey = "1" then fx("Data")(Source, 1) else fx("Data")(Source),
        DefinedNames = if List.Contains(NamedList, _tblname) then DataType[Column1]{0} else DataType,
        List =
            if
                Text.StartsWith(_tblname, "CN")
                or Text.EndsWith(_tblname, "CN")
                or Text.StartsWith(_tblname, "HEADER")
            then
                Table.ToList(DefinedNames)
            else
                DefinedNames,
        GetCN =
            if Text.Contains(_key, "CN") then
                Table.ColumnNames(List)
            else if _inputname = "DMI" then
                fx("Wstbl")("DMI")
            else
                List,
        SCol_Output =
            if not List.Contains({null, {null}}, _inputHD) then
                Table.SelectColumns(GetCN, _inputHD, MissingField.UseNull)
            else
                GetCN
    in
        SCol_Output
