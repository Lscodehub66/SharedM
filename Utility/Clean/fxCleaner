//SampleTF = Table.TransformColumns(Source, List.Transform(Table.ColumnNames(Source),each {_, each fxCleaner(_,null, {"ã€", "ã€‘"}, {"", ""})})),
//SampleSmartClean = Table.AddColumn(Source, "ã€ã€‘", each fxCleaner([Column],"ä¸»ä½“")),
let
    Source = (
        InputText as nullable text,
        optional FTextInput as nullable text,
        optional FinderList as nullable list,
        optional ReplacerList as nullable list
    ) =>
        let
            // Input Transform
            TextName =
                if InputText = null then
                    ""
                else if FTextInput = "ä¸»ä½“" and not List.ContainsAny(Text.ToList(InputText), {"A".."Z", "+"}, Comparer.OrdinalIgnoreCase)
                then
                    Text.Replace(InputText, " ", "")
                else
                    InputText,
            //
            ä¸»ä½“ = {
                {"ï¼ˆé¦™æ¸¯ï¼‰", "(é¦™æ¸¯)"},
                {"ï¼ˆ", "("},
                {"ï¼‰", ")"},
                {"/THE", ""},
                {"\THE", ""},
                {"æ‹›å•†æ°¸éš†é“¶è¡Œæœ‰é™å…¬å¸(é¦™æ¸¯)", "æ‹›å•†æ°¸éš†é“¶è¡Œæœ‰é™å…¬å¸"},
                {"EXPORT-IMPORT BANK OF CHINA/THE", "EXPORT-IMPORT BANK OF CHINA"},
                {"é¦™æ¸¯ä¸­å¤®ç»“ç®—(ä»£ç†äºº)æœ‰é™å…¬å¸", "HKSCC"},
                {"é¦™æ¸¯ä¸­å¤®çµç®—(ä»£ç†äºº)æœ‰é™å…¬å¸", "HKSCC"},
                {"äººæ°‘æ”¿åºœå›½æœ‰èµ„äº§ç›‘ç£ç®¡ç†åŠå…¬å®¤", "å›½èµ„å§”"},
                {"äººæ°‘æ”¿åºœå›½æœ‰èµ„äº§ç›‘ç£ç®¡ç†å§”å‘˜ä¼š", "å›½èµ„å§”"},
                {"å›½æœ‰èµ„äº§ç›‘ç£ç®¡ç†å§”å‘˜ä¼šåŠå…¬å®¤", "å›½èµ„å§”"},
                {"å›½æœ‰èµ„äº§ç›‘ç£ç®¡ç†å§”å‘˜ä¼š", "å›½èµ„å§”"},
                {"å›½æœ‰èµ„äº§ç›‘ç£ç®¡ç†å±€", "å›½èµ„å±€"},
                {"ç®¡ç†å§”å‘˜ä¼š", "ç®¡å§”ä¼š"},
                {"å‘å±•å’Œæ”¹é©å§”å‘˜ä¼š", "å‘æ”¹å§”"}
            },
            æ–‡æ¡£ç¬¦å· = {
                {"ğŸ”˜", ""},
                {"â­", ""},
                {"ğŸ”†", ""},
                {"ğŸ“¸", ""},
                {"/", "_"},
                {"&ETC.", ""},
                {":", "_"},
                {"(", ""},
                {")", ""},
                {"å¤šé€‰", ""},
                {"ğŸ—’ï¸", ""},
                {" ", "_"}
            },
            åœ°åŒº = {{"ç»´å¾å°”", ""}, {"å£®æ—", ""}, {"å›æ—", ""}, {"è‡ªæ²»åŒº", ""}, {"çœ", ""}, {"å¸‚", ""}, {"ç‰¹åˆ«è¡Œæ”¿åŒº", ""}},
            åŒºå¿ = {
                {"ï¼ˆ", "("},
                {"ï¼‰", ")"},
                {"è½¬å‹ç»¼åˆæ”¹é©ç¤ºèŒƒåŒº", "ç»¼æ”¹åŒº"},
                {"ä¸­å±±ç«ç‚¬é«˜æŠ€æœ¯äº§ä¸šå¼€å‘åŒº", "ç«ç‚¬å¼€å‘åŒº"},
                {"æ­¦æ±‰ä¸œæ¹–æ–°æŠ€æœ¯å¼€å‘åŒº", "ä¸œæ¹–é«˜æ–°åŒº"},
                {"é«˜æ–°æŠ€æœ¯å¼€å‘åŒº", "é«˜æ–°åŒº"},
                {"é«˜æ–°æŠ€æœ¯äº§ä¸šå¼€å‘åŒº", "é«˜æ–°åŒº"},
                {"ç»æµæŠ€æœ¯å¼€å‘åŒº", "ç»å¼€åŒº"},
                {"ç»æµå¼€å‘åŒº", "ç»å¼€åŒº"},
                {"ç»¼åˆä¿ç¨", "ä¿ç¨"},
                {"èˆªç©ºæ¸¯ç»æµç»¼åˆå®éªŒåŒº", "èˆªç©ºæ¸¯å®éªŒåŒº"}
            },
            è¯„çº§ = {
                {"(P)", ""},
                {"(EXP)", ""},
                {"WD", "--"},
                {"NR", "--"},
                {"WR", "--"},
                {"RD", "--"},
                {"u", ""},
                {"*-", ""},
                {"*", ""},
                {" ", ""},
                {"/-/", "/--/"},
                {"pi", ""},
                {"WR", ""}
            },
            è¯„çº§åˆ†ç±» = {{"æŠ•èµ„çº§", "IG"}, {"é«˜æ”¶ç›Š", "HY"}, {"è¿çº¦", "D"}, {"æ— è¯„çº§", "NR"}},
            ä»·æ ¼ = {
                {" ", ""},
                {"QUARTLYUS", "3m"},
                {"QUARTLY", "3m"},
                {"LIBOR", "L"},
                {"OVRNTSONION", "SONIA"},
                {"OVRNT", ""},
                {"O/N", ""},
                {"SOFRIX", "SOFR"},
                {"COMPOUNDED", ""},
                {"INDEX", ""},
                {"3M", ""},
                {"BPS", ""},
                {"BP", ""},
                {"åŒºåŸŸ", ""},
                {"ï¼ˆ", "("},
                {"ï¼‰", ")"},
                {"UST", "T"},
                {"AREA", ""},
                {"COMPOUNDED", ""},
                {"RATE", ""},
                {"MID-SWAP", "MS"},
                {"~", "-"},
                {"EURIBOR", "E"},
                {"(#)", ""},
                {"(THENUMBER)", ""},
                {"CT", "T"},
                {"NFIXF", "BKBM"}
            },
            ç»“æ„ = {
                {"SBLC+æ‹…ä¿+ç»´å¥½åè®®", "å¤‡è¯+æ‹…ä¿+ç»´å¥½"},
                {"ç»´å¥½åè®®+æ‹…ä¿", "ç»´å¥½+æ‹…ä¿"},
                {"ç»´å¥½åè®®+SBLC", "å¤‡è¯+ç»´å¥½"},
                {"ç›´æ¥å‘è¡Œ+æ‹…ä¿", "ç›´å‘(çº¢ç­¹)"},
                {"SBLC+æ‹…ä¿", "å¤‡è¯+æ‹…ä¿"},
                {"ç›´æ¥å‘è¡Œ", "ç›´å‘"},
                {"æ‹…ä¿å‘è¡Œ", "æ‹…ä¿"},
                {"ç»´å¥½åè®®", "ç»´å¥½"},
                {"SBLC", "å¤‡è¯"}
            },
            å“ç§ = {
                {"Sustainable", "å¯æŒç»­å‘å±•"},
                {"Blue", "è“è‰²"},
                {"Green", "ç»¿è‰²"},
                {"AT1(PrefShare)", "é¢å¤–ä¸€çº§ä¼˜å…ˆè‚¡"},
                {"AT1", "é¢å¤–ä¸€çº§èµ„æœ¬å€º"},
                {"FTZ", "æ˜ç å€º"},
                {"T2", "äºŒçº§èµ„æœ¬å€º"},
                {"MOX", "è²èŠ±å€º"},
                {"Lotus", "è²èŠ±å€º"},
                {"PP", "ç§å‹Ÿé…å”®"},
                {"LPN", "è´·æ¬¾æ”¯æŒç¥¨æ®"},
                {"JuniorPerp", "æ¬¡çº§æ°¸ç»­å€º"},
                {"SnPerp", "é«˜çº§æ°¸ç»­å€º"},
                {"Social", "ç¤¾ä¼šè´£ä»»"},
                {"PrefShare", "å¢ƒå¤–ä¼˜å…ˆè‚¡"},
                {"SLB", "å¯æŒç»­å‘å±•æŒ‚é’©"},
                {"FRN", "æµ®æ¯å€º"},
                {"DimSum", "ç‚¹å¿ƒå€º"},
                {"Senior", "é«˜çº§å€º"},
                {"SBLC", "ä¿¡ç”¨å¢å¼ºå€ºåˆ¸"},
                {"Yulan", "ç‰å…°"},
                {"Sovereign", "ä¸»æƒå€º"},
                {"CD", "å­˜æ¬¾è¯"},
                {"å€ºç‚¹å¿ƒ", "ç‚¹å¿ƒ"},
                {"--", ""}
            },
            å‘¨å‡  = {
                {"Mon", "å‘¨ä¸€"},
                {"Tue", "å‘¨äºŒ"},
                {"Wed", "å‘¨ä¸‰"},
                {"Thu", "å‘¨å››"},
                {"Fri", "å‘¨äº”"},
                {"Sat", "å‘¨å…­"},
                {"Sun", "å‘¨æ—¥"}
            },
            è´§å¸ = {
                {"MOP", "æ¾³é—¨å¸"},
                {"AUD", "æ¾³å…ƒ"},
                {"HKD", "æ¸¯å¸"},
                {"USD", "ç¾å…ƒ"},
                {"EUR", "æ¬§å…ƒ"},
                {"JPY", "æ—¥å…ƒ"},
                {"SGD", "æ–°å¸"},
                {"CNH", "å…ƒ"},
                {"NZD", "æ–°è¥¿å…°å¸"}
            },
            è§’è‰² = {
                {"PA", "é…å”®ä»£ç†"},
                {"-", ""},
                {" ", ""},
                {"CCDC", ""},
                {"B&DFOP", "åŠäº¤å‰²è¡Œ"},
                {"B&DDvP", "åŠäº¤å‰²è¡Œ"},
                {"Arranger", "åŠå®‰æ’è¡Œ"},
                {"Sole", "ç‹¬å®¶"},
                {"Dealer", "æ‰¿é”€å•†"},
                {"Leftlead", "ç‰µå¤´"},
                {"Active", ""},
                {"SGC", "JGC"},
                {"JGC", "å…¨çƒåè°ƒäºº"},
                {"JBR", "è´¦ç°¿ç®¡ç†äºº"},
                {"CoManager", "å‰¯ç»åŠäºº"},
                {"DM", "åŠäº¤æ˜“ç®¡ç†äºº"}
            },
            æŠ•èµ„è€… = {
                {"å æ¯”", ""},
                {"ï¼š", ""},
                {" / ", "/"},
                {"ï¼ˆ", ""},
                {"ï¼‰", ""},
                {"EMEA", "æ¬§æ´²ã€ä¸­ä¸œå’Œéæ´²"},
                {"ASIA", "äºšæ´²"},
                {"BANK", "é“¶è¡Œ"},
                {"FI", "é‡‘èæœºæ„"},
                {".00%", "%"},
                {".0%", "%"},
                {"#(lf)", "ï¼Œ"},
                {"èµ„äº§ç®¡ç†å…¬å¸", "èµ„ç®¡"},
                {"FM", "èµ„ç®¡"},
                {"èµ„äº§ç®¡ç†äºº", "èµ„ç®¡"},
                {"åŸºé‡‘ç»ç†", "åŸºé‡‘"},
                {"AM", "åŸºé‡‘"},
                {"åŸºé‡‘ç®¡ç†äºº", "åŸºé‡‘"},
                {"åŸºé‡‘ç®¡ç†å…¬å¸", "åŸºé‡‘"},
                {"åŸºé‡‘ç®¡ç†", "åŸºé‡‘"},
                {"ä¿é™©å…¬å¸", "ä¿é™©"},
                {"ä¿é™©æœºæ„", "ä¿é™©"},
                {"ç§äººé“¶è¡Œ", "ç§è¡Œ"},
                {"PB", "ç§è¡Œ"},
                {"SSA", "ä¸»æƒåŠè¶…ä¸»æƒæœºæ„"},
                {"ä¸»æƒã€è¶…å›½å®¶é‡‘èæœºæ„å’Œä»£ç†æœºæ„", "ä¸»æƒåŠè¶…ä¸»æƒæœºæ„"},
                {"ä¸»æƒå€ºåŠ¡è¯„çº§è¾ƒé«˜çš„éè¥åˆ©æ€§å…¬å…±éƒ¨é—¨å‘è¡Œçš„å€ºåŠ¡", "ä¸»æƒåŠè¶…ä¸»æƒæœºæ„"},
                {"TRADING", "äº¤æ˜“è´¦æˆ·"},
                {"ä¸»æƒè´¢å¯ŒåŸºé‡‘", "ä¸»æƒåŸºé‡‘"},
                {"åœ°åŒº", ""},
                {"æ¬§æ´²ä¸­ä¸œéæ´²", "æ¬§æ´²ã€ä¸­ä¸œå’Œéæ´²"},
                {"é“¶è¡Œè´¢åŠ¡éƒ¨é—¨", "å¸åº“"}
            },
            ä¸€äºŒä¸‰ = {
                {"0", "é›¶"},
                {"1", "ä¸€"},
                {"2", "äºŒ"},
                {"3", "ä¸‰"},
                {"4", "å››"},
                {"5", "äº”"},
                {"6", "å…­"},
                {"7", "ä¸ƒ"},
                {"8", "å…«"},
                {"9", "ä¹"},
                {"10", "å"}
            },
            ABC = {
                {"1", "A"},
                {"2", "B"},
                {"3", "C"},
                {"4", "D"},
                {"5", "E"},
                {"6", "F"},
                {"7", "G"},
                {"8", "H"},
                {"9", "I"},
                {"10", "J"}
            },
            å›½å®¶åŸå¸‚ = {
                {"ABUDHABI", "^AUH^", "AUH", "é˜¿å¸ƒè¾¾æ¯”"},
                {"ASTANA", "^NQZ^", "NQZ", "é˜¿æ–¯å¡”çº³"},
                {"DUBAI", "^DXB^", "DXB", "è¿ªæ‹œ"},
                {"FRANKFURT", "^FRA^", "FRA", "æ³•å…°å…‹ç¦"},
                {"HONGKONG", "^HK^", "HK", "é¦™æ¸¯"},
                {"HUNGARY", "^BUD^", "BUD", "åŒˆç‰™åˆ©"},
                {"JOHANNESBURG", "^JNB^", "JNB", "çº¦ç¿°å†…æ–¯å ¡"},
                {"LONDON", "^LON^", "LON", "ä¼¦æ•¦"},
                {"LUXEMBOURG", "^LUX^", "LUX", "å¢æ£®å ¡"},
                {"MACAU", "^MFM^", "MFM", "æ¾³é—¨"},
                {"NEWYORK", "^JFK^", "JFK", "çº½çº¦"},
                {"PARIS", "^PAR^", "PAR", "å·´é»"},
                {"SINGAPORE", "^SG^", "SG", "æ–°åŠ å¡"},
                {"SYDNEY", "^SYD^", "SYD", "æ‚‰å°¼"},
                {"TAIPEI", "^TPE^", "TPE", "å°åŒ—"},
                {"TOKYO", "^TYO^", "TYO", "ä¸œäº¬"},
                {"INDONESIA", "^IND^", "IND", "å°å°¼"},
                {"AUSTRALIA", "^AUS^", "AUS", "æ¾³å¤§åˆ©äºš"},
                {"SHANGHAI", "^PVG^", "PVG", "ä¸Šæµ·"},
                {"SYDNEY", "^SY^", "SY", "æ‚‰å°¼"},
                {"SPAIN", "^SPN^", "SPN", "è¥¿ç­ç‰™"},
                {"QATAR", "^QTR^", "QTR", "å¡å¡”å°”"}
            },
            LOCATION = List.Zip({List.Transform(å›½å®¶åŸå¸‚, each List.First(_)), List.Transform(å›½å®¶åŸå¸‚, each List.Last(_))}),
            #"LOCATION^" = List.Transform(å›½å®¶åŸå¸‚, each List.FirstN(_, 2)),
            LOCATIONCN = List.Transform(å›½å®¶åŸå¸‚, each List.LastN(_, 2)),
            RTBC = {{"ã€", ""}, {"ã€‘", ""}},
            // Select Cleaner
            FText = if FTextInput = null then "" else Text.Upper(Text.Trim(FTextInput)),
            Nested =
                if FText = "ä¸»ä½“" then
                    ä¸»ä½“
                else if List.Contains({"åœ°åŒº", "REGION"}, FText) then
                    åœ°åŒº
                else if FText = "åŒºå¿" then
                    åŒºå¿
                else if FText = "è¯„çº§" or FText = "RTG" then
                    è¯„çº§
                else if FText = "è¯„çº§åˆ†ç±»" then
                    è¯„çº§åˆ†ç±»
                else if List.Contains({"ä»·æ ¼", "FPG", "FPT", "FRN", "IPG", "IPT", "IPT", "PRICE"}, FText) then
                    ä»·æ ¼
                else if List.Contains({"ç»“æ„", "STRUCTURE"}, FText) then
                    ç»“æ„
                else if FText = "å“ç§" then
                    å“ç§
                else if List.Contains({"å‘¨å‡ ", "DDDCN"}, FText) then
                    å‘¨å‡ 
                else if List.Contains({"è´§å¸", "CRCYSUFFIX"}, FText) then
                    è´§å¸
                else if List.Contains({"è§’è‰²", "ROLE"}, FText) then
                    è§’è‰²
                else if List.Contains({"æŠ•èµ„è€…", "STATS"}, FText) then
                    æŠ•èµ„è€…
                else if FText = "ä¸€äºŒä¸‰" then
                    ä¸€äºŒä¸‰
                else if FText = "ABC" then
                    ABC
                else if FText = "LOCATION" then
                    LOCATION
                else if FText = "LOCATION^" then
                    #"LOCATION^"
                else if FText = "LOCATIONCN" then
                    LOCATIONCN
                else if FText = "RTBC" then
                    RTBC
                else if FText = "æ–‡æ¡£ç¬¦å·" then
                    æ–‡æ¡£ç¬¦å·
                else
                    {{"", ""}},
            Gettbl =
                if FText = "" then
                    Table.FromColumns({FinderList, ReplacerList}, {"Find", "Replace"})
                else
                    Table.FromRows(Nested, {"Find", "Replace"}),
            // Bulk replace
            ReplacerTable = Gettbl,
            FindReplaceList = Table.ToRows(ReplacerTable),
            Counter = Table.RowCount(ReplacerTable),
            BulkReplaceValues = (TextToReplaceTemp, n) =>
                let
                    ReplacedText = Text.Replace(
                        TextToReplaceTemp,
                        if FindReplaceList{n}{0} = null then
                            ""
                        else
                            FindReplaceList{n}{0},
                        if FindReplaceList{n}{1} = null then
                            ""
                        else
                            FindReplaceList{n}{1}
                    )
                in
                    if n = Counter - 1 then
                        ReplacedText
                    else
                        @BulkReplaceValues(ReplacedText, n + 1),
            Output = BulkReplaceValues(TextName, 0)
        in
            Output,
    //metadata-record
    fnType = type function (
        TextName as text,
        optional FTextInput as (
            type nullable text meta [
                Documentation.AllowedValues = {
                    "ä¸»ä½“",
                    "æ–‡æ¡£ç¬¦å·",
                    "åœ°åŒº",
                    "åŒºå¿",
                    "è¯„çº§",
                    "ä»·æ ¼",
                    "ç»“æ„",
                    "å“ç§",
                    "å‘¨å‡ ",
                    "è´§å¸",
                    "è§’è‰²",
                    "æŠ•èµ„è€…",
                    "ä¸€äºŒä¸‰",
                    "ABC",
                    "LOCATION",
                    "LOCATION^",
                    "LOCATIONCN"
                }
            ]
        ),
        optional FinderList as nullable list,
        optional ReplacerList as nullable list
    ) as list meta [
        Documentation.Name = "fxCleaner",
        Documentation.Description = "ä¸»ä½“ã€åœ°åŒºã€åŒºå¿ã€è¯„çº§ã€ä»·æ ¼ã€ç»“æ„ã€å“ç§ã€å‘¨å‡ ã€è´§å¸ã€è§’è‰²ã€æŠ•èµ„è€…ã€ä¸€äºŒä¸‰ã€ABCã€LOCATIONã€LOCATION^ã€LOCATIONCN"
    ]
in
    Value.ReplaceType(Source, fnType)
